<app-section-page
  title="Forms â€” Angular Reactive Forms"
  subtitle="Angular's FormBuilder vs react-hook-form â€” type-safe validation with built-in validators"
  icon="ðŸ“"
>
  <!-- Live Form Demo -->
  <div class="demo-card">
    <h3 class="demo-title">ðŸŽ® Live Reactive Form Demo</h3>
    <p class="demo-subtitle">FormBuilder + custom cross-field validator (password match)</p>

    @if (!submitted()) {
      <form
        [formGroup]="registrationForm"
        (ngSubmit)="onSubmit()"
        style="display: flex; flex-direction: column; gap: 1rem"
      >
        <!-- Name -->
        <div class="form-group">
          <label class="form-label">Full Name</label>
          <input formControlName="name" class="form-input-demo" placeholder="e.g. John Doe" />
          @if (hasError('name', 'required')) {
            <p class="error-msg">Name is required</p>
          }
          @if (hasError('name', 'minlength')) {
            <p class="error-msg">Min 2 characters</p>
          }
        </div>

        <!-- Email -->
        <div class="form-group">
          <label class="form-label">Email</label>
          <input
            formControlName="email"
            type="email"
            class="form-input-demo"
            placeholder="you@example.com"
          />
          @if (hasError('email', 'required')) {
            <p class="error-msg">Email is required</p>
          }
          @if (hasError('email', 'email')) {
            <p class="error-msg">Enter a valid email</p>
          }
        </div>

        <!-- Age -->
        <div class="form-group">
          <label class="form-label">Age</label>
          <input formControlName="age" type="number" class="form-input-demo" placeholder="18â€“120" />
          @if (hasError('age', 'required')) {
            <p class="error-msg">Age is required</p>
          }
          @if (hasError('age', 'min')) {
            <p class="error-msg">Must be 18 or older</p>
          }
          @if (hasError('age', 'max')) {
            <p class="error-msg">Must be 120 or younger</p>
          }
        </div>

        <!-- Password -->
        <div class="form-group">
          <label class="form-label">Password</label>
          <input
            formControlName="password"
            type="password"
            class="form-input-demo"
            placeholder="Min 8 chars, 1 uppercase, 1 number"
          />
          @if (hasError('password', 'required')) {
            <p class="error-msg">Password is required</p>
          }
          @if (hasError('password', 'minlength')) {
            <p class="error-msg">Minimum 8 characters</p>
          }
          @if (hasError('password', 'pattern')) {
            <p class="error-msg">Must contain uppercase and number</p>
          }
        </div>

        <!-- Confirm Password -->
        <div class="form-group">
          <label class="form-label">Confirm Password</label>
          <input
            formControlName="confirmPassword"
            type="password"
            class="form-input-demo"
            placeholder="Repeat password"
          />
          @if (hasError('confirmPassword', 'required')) {
            <p class="error-msg">Please confirm password</p>
          }
          @if (hasGroupError('passwordMismatch')) {
            <p class="error-msg">Passwords do not match</p>
          }
        </div>

        <!-- Role -->
        <div class="form-group">
          <label class="form-label">Role</label>
          <select formControlName="role" class="form-input-demo">
            <option value="user">User</option>
            <option value="admin">Admin</option>
            <option value="editor">Editor</option>
          </select>
        </div>

        <!-- Terms -->
        <div class="checkbox-row" style="display: flex; align-items: center; gap: 0.5rem">
          <input type="checkbox" formControlName="terms" id="terms" style="accent-color: #6366f1" />
          <label for="terms" style="font-size: 0.82rem; color: #94a3b8; cursor: pointer">
            I agree to the terms & conditions
          </label>
        </div>
        @if (hasError('terms', 'required')) {
          <p class="error-msg">You must accept terms</p>
        }

        <button type="submit" class="btn btn-primary">Register</button>
      </form>
    } @else {
      <div style="text-align: center; padding: 2rem">
        <div style="font-size: 3rem; margin-bottom: 1rem">âœ…</div>
        <h4 style="color: #4ade80; margin-bottom: 0.5rem">Form Submitted!</h4>
        <pre
          style="
            text-align: left;
            font-size: 0.75rem;
            color: #a5b4fc;
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
          "
          >{{ submittedData() | json }}</pre
        >
        <button class="btn btn-ghost" style="margin-top: 1rem" (click)="resetForm()">Reset</button>
      </div>
    }
  </div>

  <!-- Comparison Table -->
  <div class="concept-box">
    <h3 class="concept-title">ðŸ“š Angular Reactive Forms vs react-hook-form</h3>
    <table class="comparison-table">
      <thead>
        <tr>
          <th>Concept</th>
          <th class="react-cell">react-hook-form</th>
          <th class="angular-cell">Angular Reactive Forms</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Form Instance</td>
          <td>useForm()</td>
          <td>FormBuilder.group()</td>
        </tr>
        <tr>
          <td>Register Field</td>
          <td>...register('field')</td>
          <td>formControlName="field"</td>
        </tr>
        <tr>
          <td>Submit Handler</td>
          <td>handleSubmit(onSubmit)</td>
          <td>(ngSubmit)="onSubmit()"</td>
        </tr>
        <tr>
          <td>Error Access</td>
          <td>errors.fieldName</td>
          <td>form.get('field')?.hasError('type')</td>
        </tr>
        <tr>
          <td>Validation</td>
          <td>Inline rules / Zod resolver</td>
          <td>Built-in Validators + custom ValidatorFn</td>
        </tr>
        <tr>
          <td>Watch Field</td>
          <td>watch('fieldName')</td>
          <td>form.get('field')?.valueChanges (Observable)</td>
        </tr>
        <tr>
          <td>Patch Values</td>
          <td>setValue / reset</td>
          <td>patchValue() / reset()</td>
        </tr>
        <tr>
          <td>Form State</td>
          <td>formState.isValid, isDirty</td>
          <td>form.valid, form.dirty, form.touched</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="comparison-section">
    <h3 class="comparison-title">1. Basic Form â€” react-hook-form vs Reactive Forms</h3>
    <app-comparison-card
      [reactCode]="reactHookForm"
      [angularCode]="angularReactiveForm"
      reactLabel="react-hook-form"
      angularLabel="Angular ReactiveFormsModule"
    />
  </div>

  <div class="comparison-section">
    <h3 class="comparison-title">2. Custom Validators</h3>
    <app-code-block
      [code]="customValidatorAngular"
      language="angular-ts"
      label="Custom ValidatorFn + Cross-field validation"
    />
    <div class="key-diff-note">
      <strong>Angular advantage:</strong> Validators are pure functions â€” easily unit testable.
      Cross-field validation (like password match) goes on the <code>FormGroup</code> level, not the
      field level.
    </div>
  </div>

  <div class="comparison-section">
    <h3 class="comparison-title">3. Template-Driven Forms (Simpler Alternative)</h3>
    <app-code-block
      [code]="templateDrivenAngular"
      language="angular-ts"
      label="Template-Driven with NgModel"
    />
    <div class="key-diff-note">
      <strong>When to use which?</strong> Template-driven forms (NgModel) are simpler â€” good for
      basic forms (like Formik). Reactive forms give full programmatic control â€” ideal for complex
      dynamic forms (like react-hook-form). For new projects, prefer Reactive Forms.
    </div>
  </div>
</app-section-page>
